# Note that mongo container is started before Orion, as Orion needs it
# as dependency and reserve the order has been found problematic in some
# low resource hosts
mongo:
  image: mongo:4.4
  command: --nojournal
  hostname: mongo
  container_name: fiware-mongo
  ports:
    - "27017:27017"
  volumes:
      - "db-data:/data/db"

orion:
  image: fiware/orion:latest
  hostname: orion
  container_name: fiware-orion
  links:
    - mongo
  ports:
    - "1026:1026"
  command: -dbhost mongo

fiware-sth-comet:
  image: telefonicaiot/fiware-sth-comet
  hostname: sth-comet
  container_name: fiware-sth-comet
  links:
    - mongo
  ports:
    - "8666:8666"
  environment:
    - STH_HOST=0.0.0.0
    - STH_PORT=8666
    - DB_PREFIX=sth_
    - DB_URI=mongo:27017
    - LOGOPS_LEVEL=DEBUG
  
mosquitto:
  image: eclipse-mosquitto:latest
  hostname: mosquitto
  container_name: fiware-mosquitto
  expose:
    - "1883"
    - "9001"
  ports:
    - "1883:1883"
    - "9001:9001"
  volumes:
      - "mosquitto-data:/data/mosquitto"
  
iot-agent:
  image: fiware/iotagent-ul:latest # iotagent
  hostname: iot-agent
  container_name: fiware-iot-agent
  links:
    - mongo
    - mosquitto
  expose:
    - "4041"
  ports:
    - "4041:4041"
  environment:
    - IOTA_CB_HOST=0.0.0.0
    - IOTA_CB_PORT=1026 # port the context broker listens on to update context
    - IOTA_NORTH_PORT=4041
    - IOTA_REGISTRY_TYPE=mongo #Whether to hold IoT device info in memory or in a database
    - IOTA_LOG_LEVEL=DEBUG # The log level of the IoT Agent
    - IOTA_TIMESTAMP=true # Supply timestamp information with each measurement
    - IOTA_CB_NGSI_VERSION=v2 # use NGSIv2 when sending updates for active attributes
    - IOTA_AUTOCAST=true # Ensure Ultralight number values are read as numbers not strings
    - IOTA_MONGO_HOST=mongo # The host name of MongoDB
    - IOTA_MONGO_PORT=27017 # The port mongoDB is listening on
    - IOTA_MONGO_DB=iotagentul # The name of the database used in mongoDB
    - IOTA_MQTT_HOST=mosquitto # The host name of the MQTT Broker
    - IOTA_MQTT_PORT=1883 # The port the MQTT Broker is listening on to receive topics
#   - IOTA_DEFAULT_RESOURCE=
    - IOTA_PROVIDER_URL=http://0.0.0.0:4041 
  
      
  
